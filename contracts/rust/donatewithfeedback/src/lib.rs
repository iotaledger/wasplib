// Copyright 2020 IOTA Stiftung
// SPDX-License-Identifier: Apache-2.0

// (Re-)generated by schema tool
//////// DO NOT CHANGE THIS FILE! ////////
// Change the json schema instead

use consts::*;
use donatewithfeedback::*;
use wasmlib::*;

mod consts;
mod types;
mod donatewithfeedback;

#[no_mangle]
fn on_load() {
    let exports = ScExports::new();
    exports.add_func(FUNC_DONATE, func_donate_thunk);
    exports.add_func(FUNC_WITHDRAW, func_withdraw_thunk);
    exports.add_view(VIEW_DONATIONS, view_donations_thunk);
}

pub struct FuncDonateParams {
    pub feedback: ScImmutableString, // feedback for the person you donate to
}

fn func_donate_thunk(ctx: &ScFuncContext) {
    let p = ctx.params();
    let params = FuncDonateParams {
        feedback: p.get_string(PARAM_FEEDBACK),
    };
    func_donate(ctx, &params);
}

pub struct FuncWithdrawParams {
    pub amount: ScImmutableInt64, // amount to withdraw
}

fn func_withdraw_thunk(ctx: &ScFuncContext) {
    // only SC creator can withdraw donated funds
    ctx.require(ctx.caller() == ctx.contract_creator(), "no permission");

    let p = ctx.params();
    let params = FuncWithdrawParams {
        amount: p.get_int64(PARAM_AMOUNT),
    };
    func_withdraw(ctx, &params);
}

pub struct ViewDonationsParams {}

fn view_donations_thunk(ctx: &ScViewContext) {
    let params = ViewDonationsParams {};
    view_donations(ctx, &params);
}
